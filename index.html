<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Salario Mexicano</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { 
            font-family: 'Roboto', sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            line-height: 1.6; 
            color: #333;
            background-color: #f5f5f5;
        }
        h1, h2, h3 { color: #1976D2; }
        .page { display: none; }
        .page.active { display: block; }
        .form-group { margin-bottom: 20px; }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: 500; 
            color: #555;
        }
        input[type="text"], select { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus, select:focus {
            border-color: #1976D2;
            outline: none;
        }
        button { 
            padding: 10px 20px; 
            background-color: #1976D2; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            margin-right: 10px; 
            margin-bottom: 10px;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #1565C0; }
        .explanation { 
            background-color: #E3F2FD; 
            border-left: 4px solid #1976D2; 
            padding: 15px; 
            margin-bottom: 20px; 
            border-radius: 0 4px 4px 0;
        }
        .section { 
            margin-bottom: 30px; 
            background-color: white;
            border-radius: 4px;
            padding: 20px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }
        .header { 
            text-align: left; 
            margin-bottom: 20px; 
        }
        .logo { 
            max-width: 150px; 
            height: auto; 
            margin-bottom: 20px; 
            cursor: pointer; 
        }
        .title-box {
            background-color: #1976D2;
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            display: block;
            margin-top: 10px;
            text-align: left;
        }
        .title-box h1 {
            color: white;
            margin: 0;
        }
        .bar-graph {
            width: 100%;
            max-width: 800px;
            height: 400px;
            margin: 0 auto 40px;
            position: relative;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 20px;
        }
        .bar {
            position: absolute;
            transition: height 0.5s ease-in-out;
            border-radius: 4px 4px 0 0;
        }
        .bar-label {
            position: absolute;
            bottom: -30px;
            transform: translateX(-50%);
            text-align: center;
            font-size: 12px;
            width: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .bar-value {
            position: absolute;
            top: -20px;
            transform: translateX(-50%);
            text-align: center;
            font-size: 12px;
            font-weight: bold;
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 12px; 
            text-align: left; 
        }
        th { 
            background-color: #1976D2; 
            color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="finmango.png" alt="FinMango Logo" class="logo" onclick="showPage('introPage')">
        <div class="title-box">
            <h1>Calculadora de Salario Mexicano</h1>
        </div>
    </div>

    <div id="introPage" class="page active">
        <h2>Bienvenido a Tu Calculadora Integral de Salario Mexicano</h2>
        <div class="explanation">
            <p><span class="material-icons">info</span> Esta calculadora te ayuda a evaluar tu situación financiera en diferentes ciudades de México. Considera factores como:</p>
            <ul>
                <li>Tu salario anual</li>
                <li>Impuesto sobre la renta mexicano</li>
                <li>Estimaciones de gastos de vida en varias ciudades</li>
            </ul>
            <p>Compara hasta tres ciudades para tomar decisiones informadas sobre dónde vivir y trabajar en México.</p>
        </div>
        <div class="button-container">
            <button onclick="showPage('locationPage')"><span class="material-icons">arrow_forward</span> Empecemos</button>
        </div>
    </div>
    
    <div id="locationPage" class="page">
        <h2>Selecciona Ciudades para Comparar</h2>
        <div class="explanation">
            <p><span class="material-icons">location_city</span> Elige hasta tres ciudades mexicanas que te gustaría comparar.</p>
        </div>
        <div class="section">
            <div class="form-group">
                <label for="location1">Ciudad 1:</label>
                <select id="location1" required></select>
            </div>
            <div class="form-group">
                <label for="location2">Ciudad 2 (opcional):</label>
                <select id="location2"></select>
            </div>
            <div class="form-group">
                <label for="location3">Ciudad 3 (opcional):</label>
                <select id="location3"></select>
            </div>
        </div>
        <div class="button-container">
            <button onclick="showPage('introPage')"><span class="material-icons">arrow_back</span> Anterior</button>
            <button onclick="showPage('salaryPage')"><span class="material-icons">arrow_forward</span> Siguiente</button>
        </div>
    </div>

    <div id="salaryPage" class="page">
        <h2>Ingresa tu Información Salarial</h2>
        <div class="explanation">
            <p><span class="material-icons">monetization_on</span> Proporciona tu salario anual en Pesos Mexicanos (MXN). Esta información se usará para calcular tu pago neto después de impuestos y compararlo con el costo de vida en cada ciudad seleccionada.</p>
        </div>
        <div class="section">
            <div class="form-group">
                <label for="salary">Salario Anual (MXN):</label>
                <input type="text" id="salary" required>
            </div>
        </div>
        <div class="button-container">
            <button onclick="showPage('locationPage')"><span class="material-icons">arrow_back</span> Anterior</button>
            <button onclick="calculateResults()"><span class="material-icons">calculate</span> Calcular Resultados</button>
        </div>
    </div>

    <div id="resultsPage" class="page">
        <h2>Comparación de tu Salario y Costo de Vida</h2>
        <div class="explanation">
            <p><span class="material-icons">assessment</span> A continuación se muestra un resumen de tu situación financiera en cada ciudad mexicana seleccionada. Esto incluye tu pago neto y gastos anuales estimados. Haz clic en "Mostrar Desglose" para ver cálculos detallados.</p>
        </div>
        <div id="resultsContainer">
            <!-- Results will be inserted here by JavaScript -->
        </div>
        <div class="button-container">
            <button onclick="showPage('locationPage')"><span class="material-icons">refresh</span> Empezar de Nuevo</button>
        </div>
    </div>

    <script>
    const cityData = {
        "Ciudad de México": {
            rent: 15000,
            utilities: 1000,
            internet: 500,
            groceries: 3000,
            transportation: 1000,
            dining: 2000,
            entertainment: 1500
        },
        "Guadalajara": {
            rent: 10000,
            utilities: 900,
            internet: 500,
            groceries: 2800,
            transportation: 800,
            dining: 1800,
            entertainment: 1300
        },
        "Monterrey": {
            rent: 12000,
            utilities: 950,
            internet: 500,
            groceries: 2900,
            transportation: 900,
            dining: 1900,
            entertainment: 1400
        },
        "Puebla": {
            rent: 8000,
            utilities: 850,
            internet: 500,
            groceries: 2700,
            transportation: 700,
            dining: 1700,
            entertainment: 1200
        },
        "Querétaro": {
            rent: 9000,
            utilities: 900,
            internet: 500,
            groceries: 2800,
            transportation: 750,
            dining: 1800,
            entertainment: 1300
        },
        "Mérida": {
            rent: 8500,
            utilities: 900,
            internet: 500,
            groceries: 2700,
            transportation: 700,
            dining: 1700,
            entertainment: 1200
        },
        "Tijuana": {
            rent: 11000,
            utilities: 950,
            internet: 500,
            groceries: 2900,
            transportation: 850,
            dining: 1900,
            entertainment: 1400
        },
        "Cancún": {
            rent: 12000,
            utilities: 1000,
            internet: 500,
            groceries: 3000,
            transportation: 800,
            dining: 2000,
            entertainment: 1500
        }
    };

    function populateLocations() {
        const selects = [document.getElementById('location1'), document.getElementById('location2'), document.getElementById('location3')];
        selects.forEach(select => {
            select.innerHTML = '<option value="">Selecciona una ciudad</option>';
            Object.keys(cityData).forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                select.appendChild(option);
            });
        });
    }

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
    }

    function calculateMexicanTax(salary) {
        // 2023 Mexican tax brackets (simplified)
        if (salary <= 7735.00) return 0;
        if (salary <= 65651.07) return (salary - 7735.00) * 0.0640 + 148.51;
        if (salary <= 115375.90) return (salary - 65651.07) * 0.1088 + 3855.14;
        if (salary <= 134119.41) return (salary - 115375.90) * 0.16 + 9265.20;
        if (salary <= 160577.65) return (salary - 134119.41) * 0.1792 + 12264.16;
        if (salary <= 323862.00) return (salary - 160577.65) * 0.2136 + 17005.47;
        if (salary <= 510451.00) return (salary - 323862.00) * 0.2352 + 51883.01;
        if (salary <= 974535.03) return (salary - 510451.00) * 0.30 + 95768.74;
        if (salary <= 1299380.04) return (salary - 974535.03) * 0.32 + 234993.95;
        if (salary <= 3898140.12) return (salary - 1299380.04) * 0.34 + 338944.34;
        return (salary - 3898140.12) * 0.35 + 1222522.76;
    }

    function formatMoney(amount) {
        return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(amount);
    }

    function calculateResults() {
        const salary = parseFloat(document.getElementById('salary').value.replace(/[^0-9.]/g, ''));
        const selectedLocations = [
            document.getElementById('location1').value,
            document.getElementById('location2').value,
            document.getElementById('location3').value
        ].filter(Boolean);

        if (!salary || selectedLocations.length === 0) {
            alert('Por favor, ingresa tu salario y selecciona al menos una ciudad.');
            return;
        }

        const results = selectedLocations.map(city => {
            const costs = cityData[city];
            const incomeTax = calculateMexicanTax(salary);
            const takehomePay = salary - incomeTax;
            const totalMonthlyExpenses = Object.values(costs).reduce((a, b) => a + b, 0);
            const totalAnnualExpenses = totalMonthlyExpenses * 12;

            return {
                city,
                grossPay: salary,
                incomeTax,
                takehomePay,
                monthlyCosts: costs,
                totalMonthlyExpenses,
                totalAnnualExpenses,
                remainingMoney: takehomePay - totalAnnualExpenses
            };
        });

   displayResults(results);
        showPage('resultsPage');
    }

    function displayResults(results) {
        const container = document.getElementById('resultsContainer');
        container.innerHTML = '';

        // Add bar graph
        const graphDiv = document.createElement('div');
        graphDiv.className = 'section';
        graphDiv.innerHTML = '<h3>Comparación de Dinero Restante</h3>';
        const barGraph = document.createElement('div');
        barGraph.className = 'bar-graph';

        const maxAbsRemaining = Math.max(...results.map(r => Math.abs(r.remainingMoney)));
        barGraph.style.width = '100%';

        results.forEach((result, index) => {
            const bar = document.createElement('div');
            bar.className = 'bar';
            const height = (Math.abs(result.remainingMoney) / maxAbsRemaining) * 45;
            bar.style.height = `${height}%`;
            bar.style.left = `${(index / results.length) * 100}%`;
            bar.style.width = `${100 / results.length - 5}%`;
            bar.style.backgroundColor = result.remainingMoney >= 0 ? '#4CAF50' : '#F44336';
            bar.style.bottom = result.remainingMoney >= 0 ? '50%' : `calc(50% - ${height}%)`;

            const label = document.createElement('div');
            label.className = 'bar-label';
            label.textContent = result.city;
            label.style.left = `${(index / results.length) * 100 + (100 / results.length / 2)}%`;
            label.style.bottom = '-30px';

            const value = document.createElement('div');
            value.className = 'bar-value';
            value.textContent = formatMoney(result.remainingMoney);
            value.style.left = `${(index / results.length) * 100 + (100 / results.length / 2)}%`;
            value.style.bottom = `${result.remainingMoney >= 0 ? height + 50 : 50 - height}%`;

            barGraph.appendChild(bar);
            barGraph.appendChild(label);
            barGraph.appendChild(value);
        });

        graphDiv.appendChild(barGraph);
        container.appendChild(graphDiv);

        // Detailed results
        results.forEach((result, index) => {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'section';
            resultDiv.innerHTML = `
                <h3>${result.city}</h3>
                <p>Salario Neto: ${formatMoney(result.takehomePay)}</p>
                <p>Gastos Anuales: ${formatMoney(result.totalAnnualExpenses)}</p>
                <p>Dinero Restante: <span style="color: ${result.remainingMoney >= 0 ? 'green' : 'red'}">${formatMoney(result.remainingMoney)}</span></p>
                <button class="toggle-breakdown" onclick="toggleBreakdown('breakdown-${index}')">
                    <span class="material-icons">expand_more</span> Mostrar Desglose
                </button>
                <div id="breakdown-${index}" class="breakdown" style="display: none;">
                    <h4>Desglose Detallado</h4>
                    <table>
                        <tr><td>Salario Bruto:</td><td>${formatMoney(result.grossPay)}</td></tr>
                        <tr><td>Impuesto sobre la Renta:</td><td>${formatMoney(result.incomeTax)}</td></tr>
                        <tr><td>Salario Neto:</td><td>${formatMoney(result.takehomePay)}</td></tr>
                        <tr><th colspan="2">Gastos Mensuales</th></tr>
                        <tr><td>Alquiler:</td><td>${formatMoney(result.monthlyCosts.rent)}</td></tr>
                        <tr><td>Servicios Públicos:</td><td>${formatMoney(result.monthlyCosts.utilities)}</td></tr>
                        <tr><td>Internet:</td><td>${formatMoney(result.monthlyCosts.internet)}</td></tr>
                        <tr><td>Alimentación:</td><td>${formatMoney(result.monthlyCosts.groceries)}</td></tr>
                        <tr><td>Transporte:</td><td>${formatMoney(result.monthlyCosts.transportation)}</td></tr>
                        <tr><td>Comidas Fuera:</td><td>${formatMoney(result.monthlyCosts.dining)}</td></tr>
                        <tr><td>Entretenimiento:</td><td>${formatMoney(result.monthlyCosts.entertainment)}</td></tr>
                        <tr><td>Total Gastos Mensuales:</td><td>${formatMoney(result.totalMonthlyExpenses)}</td></tr>
                        <tr><td>Total Gastos Anuales:</td><td>${formatMoney(result.totalAnnualExpenses)}</td></tr>
                        <tr><td>Dinero Restante:</td><td>${formatMoney(result.remainingMoney)}</td></tr>
                    </table>
                </div>
            `;
            container.appendChild(resultDiv);
        });
    }

    function toggleBreakdown(id) {
        const breakdown = document.getElementById(id);
        breakdown.style.display = breakdown.style.display === 'none' ? 'block' : 'none';
    }

    function validateForm() {
        const salary = document.getElementById('salary').value.trim();
        const location1 = document.getElementById('location1').value;
        
        if (!salary || !location1) {
            alert('Por favor, ingresa tu salario y selecciona al menos una ubicación.');
            return false;
        }
        return true;
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
        populateLocations();

        const salaryInput = document.getElementById('salary');
        salaryInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value !== '') {
                value = parseInt(value, 10).toLocaleString('es-MX');
            }
            e.target.value = value;
        });

        const locationSelects = [
            document.getElementById('location1'),
            document.getElementById('location2'),
            document.getElementById('location3')
        ];

        locationSelects.forEach((select, index) => {
            select.addEventListener('change', function() {
                const selectedValue = this.value;
                locationSelects.forEach((otherSelect, otherIndex) => {
                    if (otherIndex !== index) {
                        Array.from(otherSelect.options).forEach(option => {
                            option.disabled = (option.value === selectedValue && selectedValue !== '');
                        });
                    }
                });
            });
        });
    });
    </script>
</body>
</html>
